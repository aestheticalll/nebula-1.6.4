package nebula.client.module.impl.exploit.fastuse;

import nebula.client.listener.bus.Listener;
import nebula.client.listener.bus.Subscribe;
import nebula.client.listener.event.player.EventUpdate;
import nebula.client.module.Module;
import nebula.client.module.ModuleMeta;
import nebula.client.util.value.Setting;
import nebula.client.util.value.SettingMeta;
import net.minecraft.item.ItemBow;
import net.minecraft.item.ItemFood;
import net.minecraft.item.ItemPotion;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.C03PacketPlayer;

/**
 * @author Gavin
 * @since 08/09/23
 */
@SuppressWarnings("unused")
@ModuleMeta(name = "FastUse", description = "Uses items faster by sending more packets")
public class FastUseModule extends Module
{
  @SettingMeta("In Use Ticks")
  private final Setting<Integer> inUseTicks = new Setting<>(
      10, 0, 20, 1);

  @SettingMeta("Food")
  private final Setting<Boolean> food = new Setting<>(
      true);
  @SettingMeta("Potions")
  private final Setting<Boolean> potions = new Setting<>(
      true);
  @SettingMeta("Bows")
  private final Setting<Boolean> bows = new Setting<>(
      true);
  @Subscribe
  private final Listener<EventUpdate> update = event ->
  {
    ItemStack itemInUse = mc.thePlayer.getItemInUse();
    if (!mc.thePlayer.isUsingItem()
        || !validStack(itemInUse)
        || mc.thePlayer.getItemInUseDuration() < inUseTicks.value()) return;

    for (int i = 0; i < 20 - mc.thePlayer.getItemInUseDuration(); ++i)
    {
      mc.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer());
    }
  };

  @Override
  public String info()
  {
    return String.valueOf(inUseTicks.value());
  }

  private boolean validStack(ItemStack stack)
  {
    if (stack == null) return false;
    return (food.value() && stack.getItem() instanceof ItemFood)
        || (potions.value() && stack.getItem() instanceof ItemPotion)
        || (bows.value() && stack.getItem() instanceof ItemBow);
  }
}
