package nebula.client.module.impl.exploit.thunderlocator;

import nebula.client.listener.bus.Listener;
import nebula.client.listener.bus.Subscribe;
import nebula.client.listener.event.net.EventPacket;
import nebula.client.module.Module;
import nebula.client.module.ModuleMeta;
import nebula.client.util.chat.Printer;
import net.minecraft.entity.effect.EntityLightningBolt;
import net.minecraft.network.play.server.S29PacketSoundEffect;

import static java.lang.String.format;

/**
 * @author Gavin
 * @since 08/24/23
 */
@SuppressWarnings("unused")
@ModuleMeta(name = "ThunderLocator",
    description = "Locates thunder on the server")
public class ThunderLocatorModule extends Module
{

  /**
   * The thunder sound id
   * {@link EntityLightningBolt#onUpdate()}
   */
  private static final String THUNDER_SOUND_ID = "ambient.weather.thunder";

  @Subscribe
  private final Listener<EventPacket.In> packetIn = event ->
  {
    if (event.packet() instanceof S29PacketSoundEffect packet)
    {
      if (!packet.func_149212_c().equals(THUNDER_SOUND_ID)) return;

      double x = packet.func_149207_d();
      double y = packet.func_149211_e();
      double z = packet.func_149210_f();

      Printer.print(format(
          "Thunder sounded at XYZ: %.1f, %.1f, %.1f (%.1f blocks away)",
          x, y, z, mc.thePlayer.getDistance(x, y, z)));
    }
  };
}
